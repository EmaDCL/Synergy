<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Asignar Tareas – Synergy</title>
  <link rel="stylesheet" href="/css/Lider_AsignarTareas.css">
</head>

<body>

  <header>
    <h1>Synergy</h1>
    <nav>
      <a th:href="@{/dashboard}">Inicio</a>
      <a th:href="@{/proyectos/lista}">Proyectos</a>
      <a th:href="@{/logout}">Salir</a>
    </nav>
  </header>

  <section class="hero">

    <div class="task-container">

      <h2>Asignar nueva tarea</h2>
      <p>Proyecto: <strong th:text="${proyecto.nombre}"></strong></p>

      <!-- FORMULARIO -->
      <form class="task-form"
            th:action="@{'/tareas/asignar/' + ${proyecto.id}}"
            method="post">

        <div class="form-group">
          <label for="nombreTarea">Título de la tarea:</label>
          <input type="text" id="nombreTarea" name="titulo"
                 placeholder="Ej. Diseñar interfaz principal" required>
        </div>

        <div class="form-group">
          <label for="descripcion">Descripción:</label>
          <textarea id="descripcion" name="descripcion" rows="3"
                    placeholder="Describe brevemente la tarea" required></textarea>
        </div>

        <div class="form-group">
          <label for="fecha">Fecha límite:</label>
          <input type="date" id="fecha" name="fechaEntrega" required>
        </div>

        <!-- LISTA DE USUARIOS PARTICIPANTES -->
        <div class="form-group">
          <label>Asignar a usuarios:</label>

          <div class="usuarios-lista">

            <div th:each="u : ${usuariosParticipantes}" class="usuario-item">
              <input type="checkbox"
                     name="usuariosAsignados"
                     th:value="${u.id}">
              <span th:text="${u.nombre}"></span>
            </div>

            <p th:if="${#lists.isEmpty(usuariosParticipantes)}"
               style="color:red; margin-top:10px;">
              No hay participantes inscritos en este proyecto.
            </p>

          </div>
        </div>

        <button type="submit" class="btn-asignar">Asignar tarea</button>

      </form>
    </div>

    <!-- LISTADO DE TAREAS EXISTENTES -->
    <div class="task-list">

      <h3>Tareas creadas</h3>

      <table>
        <thead>
          <tr>
            <th>Tarea</th>
            <th>Descripción</th>
            <th>Fecha límite</th>
            <th>Usuarios asignados</th>
            <th>Acciones</th>
          </tr>
        </thead>

        <tbody>

          <tr th:each="tarea : ${tareas}">
            <td th:text="${tarea.titulo}"></td>
            <td th:text="${tarea.descripcion}"></td>
            <td th:text="${tarea.fechaEntrega}"></td>

            <td>
              <span th:each="u : ${tarea.usuarios}"
                    th:text="${u.nombre} + ' '" 
                    style="margin-right:5px"></span>

              <span th:if="${#sets.isEmpty(tarea.usuarios)}">
                Sin asignar
              </span>
            </td>

            <td>
              <form th:action="@{'/tareas/eliminar/' + ${tarea.id}}"
                    method="post">
                <button type="submit" class="btn-eliminar">Eliminar</button>
              </form>
            </td>
          </tr>

        </tbody>
      </table>

    </div>

  </section>

</body>

</html>
